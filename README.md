# test2



&НаКлиенте
Процедура СделатьФото(Команда)
	#Если МобильноеПриложениеКлиент Тогда
		Если СредстваМультимедиа.ПоддерживаетсяФотоснимок() Тогда
			ДанныеМультимедиа = СредстваМультимедиа.СделатьФотоснимок();
			Если ДанныеМультимедиа <> Неопределено Тогда
				ТекущееФото = ДанныеМультимедиа.ПолучитьДвоичныеДанные();
				Фото = ПоместитьВоВременноеХранилище(ТекущееФото, Новый УникальныйИдентификатор);
				УстановитьКартинку();
			КонецЕсли;
		Иначе    
			Сообщить(НСтр("ru = 'Съемка фото не поддерживается.'", "ru"));
		КонецЕсли; 
	#КонецЕсли
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьКартинку(Команда)
	НачатьПомещениеФайла(Новый ОписаниеОповещения("ЗавершениеПомещенияФайла",ЭтотОбъект));
КонецПроцедуры

Процедура ЗавершениеПомещенияФайла(Результат, Адрес, ВыбранноеИмяФайла, ДополнительныеПараметры) Экспорт 
	
	Если Результат Тогда
		Фото = Адрес;
		УстановитьКартинку();
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура УстановитьКартинку()

	НовыйФайлКартинки = Справочники.Фото.СоздатьЭлемент();
	НовыйФайлКартинки.Файл = Новый ХранилищеЗначения(ПолучитьИзВременногоХранилища(Фото));
	
	НовыйФайлКартинки.Записать();
	
	Фото = ПоместитьВоВременноеХранилище(НовыйФайлКартинки.Файл.Получить());
	
	Объект.Фото = НовыйФайлКартинки.Ссылка;
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
		Фото = ПолучитьНавигационнуюСсылку(Объект.Фото, "Файл");
КонецПроцедуры
 
&НаКлиенте
Процедура ВключитьНапоминание(Команда)
	ВключитьНапоминаниеНаСервере();
КонецПроцедуры


&НаСервере
Процедура ВключитьНапоминаниеНаСервере()
	
	Если ДеньГода(ТекущаяДата())<ДеньГода(Объект.ДатаРождения) Тогда        //Было ли в этом году уже?
		ДатаУведомления = НачалоГода(ТекущаяДата())+ДеньГода(Объект.ДатаРождения-1)*24*60*60;    //НачалоГода возвращает 1 янв тек года, ДеньГода возвращает число(кол-во дней с 1 янв)
	Иначе 
		ДатаУведомления = УниверсальноеВремя(НачалоГода(ДобавитьМесяц(ТекущаяДата(),12))+ДеньГода(Объект.ДатаРождения-1)*24*60*60);
	КонецЕсли;
	
	ЛетИсполнилось = Год(ДатаУведомления)-Год(Объект.ДатаРождения);
	
	Если Константы.РежимТестировщика.Получить() Тогда   //чтобы не ждать уведомление, +10сек к тек времени
		ДатаУведомления = ТекущаяДата()+10;
	КонецЕсли;
	
	Напоминание = Новый ДоставляемоеУведомление;
	Напоминание.Наклейка = ЛетИсполнилось;
	Напоминание.Заголовок = "ДР у товарища "+ЛетИсполнилось+" лет!!!"; 
	Напоминание.ЗвуковоеОповещение = ЗвуковоеОповещение.ПоУмолчанию;
	Напоминание.Текст = "Сегодня ДР у "+Объект.ФИО+" ему теперь "+ЛетИсполнилось+" лет!!!";
	Напоминание.ДатаПоявленияУниверсальноеВремя = УниверсальноеВремя(ДатаУведомления);
		
	ДоставляемыеУведомления.ДобавитьЛокальноеУведомление(Напоминание);
КонецПроцедуры



&НаКлиенте
Процедура ВоспроизвестиАудио(Команда)
	#Если МобильноеПриложениеКлиент Тогда
		Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
		Если Диалог.Выбрать() Тогда
			Данные = Диалог.ПолноеИмяФайла;
			СредстваМультимедиа.ВоспроизвестиАудио(Данные);
			Файл = Новый Файл(Диалог.ПолноеИмяФайла);
			Сообщить("" + Файл.ПолучитьПредставлениеФайлаБиблиотекиМобильногоУстройства() + " длительностью " + СредстваМультимедиа.ПолучитьПродолжительностьАудио(Данные) + " секунд");
		КонецЕсли;
	#КонецЕсли
	
КонецПроцедуры
&НаКлиенте
Процедура Остановить(Команда)
	СредстваМультимедиа.ОстановитьВоспроизведениеАудио();
КонецПроцедуры
